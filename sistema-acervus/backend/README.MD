# Sistema de GestÃ£o de EstÃ¡gios e Aprendizagem - Backend

Sistema completo para gerenciamento de estÃ¡gios e programas de jovem aprendiz, desenvolvido com Node.js, TypeScript, PostgreSQL e Prisma ORM.

## ğŸš€ CaracterÃ­sticas

- âœ… **API REST completa** com autenticaÃ§Ã£o JWT
- âœ… **Banco de dados robusto** com PostgreSQL e Prisma ORM
- âœ… **ValidaÃ§Ãµes automÃ¡ticas** (CPF, CNPJ, email, telefone)
- âœ… **Sistema de permissÃµes** por perfil de usuÃ¡rio
- âœ… **IntegraÃ§Ã£o com Receita Federal** para consulta de CNPJ
- âœ… **GeraÃ§Ã£o de PDFs** para contratos e convÃªnios
- âœ… **Rate limiting** e medidas de seguranÃ§a
- âœ… **Arquitetura escalÃ¡vel** e bem estruturada

## ğŸ“‹ Funcionalidades

### Cadastros Principais
- **EstagiÃ¡rios**: Cadastro completo com validaÃ§Ã£o de menor de idade
- **Jovens Aprendizes**: GestÃ£o de carteira de trabalho e dados especÃ­ficos
- **Empresas/Concedentes**: IntegraÃ§Ã£o com Receita Federal, gestÃ£o de taxas
- **InstituiÃ§Ãµes de Ensino**: ConvÃªnios automÃ¡ticos, professores orientadores
- **Supervisores**: VinculaÃ§Ã£o com empresas e setores
- **UsuÃ¡rios Internos**: Sistema de permissÃµes (Admin, Gestor, Operador, Consultor)

### Sistema de Contratos (Futuro)
- GeraÃ§Ã£o automÃ¡tica de contratos de estÃ¡gio
- Termos aditivos com histÃ³rico de alteraÃ§Ãµes
- Controle de vencimentos e alertas
- DocumentaÃ§Ã£o completa em PDF

## ğŸ› ï¸ Tecnologias

- **Node.js** + **TypeScript**
- **Express.js** - Framework web
- **PostgreSQL** - Banco de dados
- **Prisma ORM** - Gerenciamento de banco
- **JWT** - AutenticaÃ§Ã£o
- **bcryptjs** - Hash de senhas
- **Zod** - ValidaÃ§Ã£o de dados
- **Helmet** - SeguranÃ§a
- **Rate Limiting** - ProteÃ§Ã£o contra spam

## ğŸ“¦ InstalaÃ§Ã£o

### PrÃ©-requisitos
- Node.js 18+ 
- PostgreSQL 12+
- npm ou yarn

### 1. Clone o repositÃ³rio
```bash
git clone https://github.com/seu-usuario/sistema-gestao-estagios.git
cd sistema-gestao-estagios
```

### 2. Instale as dependÃªncias
```bash
npm install
```

### 3. Configure o banco de dados
```bash
# Copie o arquivo de exemplo
cp .env.example .env

# Edite o arquivo .env com suas configuraÃ§Ãµes
# DATABASE_URL="postgresql://usuario:senha@localhost:5432/sistema_estagios"
# JWT_SECRET="seu_jwt_secret_muito_seguro"
```

### 4. Execute as migraÃ§Ãµes do banco
```bash
# Gerar cliente Prisma
npm run db:generate

# Aplicar migraÃ§Ãµes
npm run db:push

# OU criar migraÃ§Ãµes (em produÃ§Ã£o)
npm run db:migrate
```

### 5. Execute o seed inicial
```bash
npm run db:seed
```

### 6. Inicie o servidor
```bash
# Desenvolvimento
npm run dev

# ProduÃ§Ã£o
npm run build
npm start
```

## ğŸ¯ API Endpoints

### AutenticaÃ§Ã£o
```
POST   /api/auth/login              # Login
GET    /api/auth/perfil             # Perfil do usuÃ¡rio logado
PUT    /api/auth/alterar-senha      # Alterar senha
GET    /api/auth/usuarios           # Listar usuÃ¡rios (Gestor+)
POST   /api/auth/usuarios           # Criar usuÃ¡rio (Admin)
PUT    /api/auth/usuarios/:id       # Editar usuÃ¡rio (Admin)
```

### EstagiÃ¡rios
```
GET    /api/estagiarios             # Listar estagiÃ¡rios
GET    /api/estagiarios/:id         # Buscar estagiÃ¡rio
POST   /api/estagiarios             # Criar estagiÃ¡rio (Gestor+)
PUT    /api/estagiarios/:id         # Editar estagiÃ¡rio (Gestor+)
PUT    /api/estagiarios/:id/desativar  # Desativar (Gestor+)
```

### Jovens Aprendizes
```
GET    /api/jovens-aprendizes       # Listar jovens aprendizes
GET    /api/jovens-aprendizes/:id   # Buscar jovem aprendiz
POST   /api/jovens-aprendizes       # Criar (Gestor+)
PUT    /api/jovens-aprendizes/:id   # Editar (Gestor+)
```

### Empresas
```
GET    /api/empresas                # Listar empresas
GET    /api/empresas/:id            # Buscar empresa
POST   /api/empresas                # Criar empresa (Gestor+)
PUT    /api/empresas/:id            # Editar empresa (Gestor+)
GET    /api/empresas/consultar-cnpj/:cnpj  # Consultar CNPJ
POST   /api/empresas/:id/gerar-convenio    # Gerar convÃªnio
```

### InstituiÃ§Ãµes de Ensino
```
GET    /api/instituicoes-ensino     # Listar instituiÃ§Ãµes
GET    /api/instituicoes-ensino/:id # Buscar instituiÃ§Ã£o
POST   /api/instituicoes-ensino     # Criar (Gestor+)
PUT    /api/instituicoes-ensino/:id # Editar (Gestor+)
```

### Supervisores e Setores
```
GET    /api/supervisores            # Listar supervisores
GET    /api/supervisores/:id        # Buscar supervisor
POST   /api/supervisores            # Criar (Gestor+)
PUT    /api/supervisores/:id        # Editar (Gestor+)

GET    /api/supervisores/setores    # Listar setores por empresa
POST   /api/supervisores/setores    # Criar setor (Gestor+)
PUT    /api/supervisores/setores/:id  # Editar setor (Gestor+)
DELETE /api/supervisores/setores/:id  # Excluir setor (Gestor+)
```

## ğŸ” Sistema de PermissÃµes

### Perfis de UsuÃ¡rio
- **ADMIN**: Acesso total ao sistema
- **GESTOR**: CriaÃ§Ã£o e ediÃ§Ã£o de cadastros
- **OPERADOR**: Consulta e operaÃ§Ãµes bÃ¡sicas
- **CONSULTOR**: Apenas consulta

### AutenticaÃ§Ã£o JWT
```javascript
// Header de Authorization
Authorization: Bearer <seu_jwt_token>
```

## ğŸ“Š Modelo de Dados

### Entidades Principais
- **Usuario**: UsuÃ¡rios internos do sistema
- **Estagiario**: Estudantes interessados em estÃ¡gio
- **JovemAprendiz**: Jovens no programa de aprendizagem
- **Empresa**: Empresas concedentes
- **InstituicaoEnsino**: Universidades e escolas
- **Supervisor**: ResponsÃ¡veis nas empresas
- **Setor**: Departamentos das empresas
- **ContratoEstagio**: Contratos de estÃ¡gio (futuro)
- **ContratoAprendiz**: Contratos de aprendizagem (futuro)

## ğŸ” ValidaÃ§Ãµes Implementadas

### CPF e CNPJ
- ValidaÃ§Ã£o de dÃ­gitos verificadores
- Formato automÃ¡tico com pontos e traÃ§os
- VerificaÃ§Ã£o de duplicatas

### Email e Telefone
- ValidaÃ§Ã£o de formato
- NormalizaÃ§Ã£o automÃ¡tica

### EndereÃ§os
- ValidaÃ§Ã£o de CEP
- Campos obrigatÃ³rios

### Menor de Idade
- DetecÃ§Ã£o automÃ¡tica por data de nascimento
- Campos obrigatÃ³rios para responsÃ¡vel

## ğŸš¨ SeguranÃ§a

### Medidas Implementadas
- **Rate Limiting**: 100 req/15min geral, 5 req/15min para login
- **Helmet**: Headers de seguranÃ§a
- **CORS**: Configurado para frontend especÃ­fico
- **JWT**: Tokens com expiraÃ§Ã£o
- **Hash de Senhas**: bcrypt com salt
- **ValidaÃ§Ã£o de Entrada**: SanitizaÃ§Ã£o de dados

## ğŸ“ UsuÃ¡rios PadrÃ£o (Seed)

ApÃ³s executar o seed, os seguintes usuÃ¡rios estarÃ£o disponÃ­veis:

```
Admin:
- Email: admin@cide.com.br
- Senha: admin123

Gestor:
- Email: gestor@cide.com.br  
- Senha: gestor123

Operador:
- Email: operador@cide.com.br
- Senha: operador123
```

## ğŸ› ï¸ Scripts DisponÃ­veis

```bash
npm run dev          # Desenvolvimento com hot reload
npm run build        # Build para produÃ§Ã£o
npm start            # Executar produÃ§Ã£o
npm run db:generate  # Gerar cliente Prisma
npm run db:push      # Aplicar schema ao banco
npm run db:migrate   # Criar migraÃ§Ãµes
npm run db:seed      # Executar seed
npm test             # Executar testes
```

## ğŸ“‚ Estrutura do Projeto

```
src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.ts          # ConfiguraÃ§Ã£o Prisma
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ authController.ts    # AutenticaÃ§Ã£o e usuÃ¡rios
â”‚   â”œâ”€â”€ estagiarioController.ts
â”‚   â”œâ”€â”€ jovemAprendizController.ts
â”‚   â”œâ”€â”€ empresaController.ts
â”‚   â”œâ”€â”€ instituicaoEnsinoController.ts
â”‚   â””â”€â”€ supervisorController.ts
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.ts              # AutenticaÃ§Ã£o JWT
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ estagiarios.ts
â”‚   â”œâ”€â”€ jovensAprendizes.ts
â”‚   â”œâ”€â”€ empresas.ts
â”‚   â”œâ”€â”€ instituicoesEnsino.ts
â”‚   â”œâ”€â”€ supervisores.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ seed.ts              # Dados iniciais
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ validators.ts        # Validadores
â”œâ”€â”€ app.ts                   # ConfiguraÃ§Ã£o Express
â””â”€â”€ server.ts                # Servidor principal

prisma/
â””â”€â”€ schema.prisma            # Schema do banco
```

## ğŸ› Tratamento de Erros

O sistema implementa tratamento robusto de erros:

- **ValidaÃ§Ã£o de entrada**: Dados invÃ¡lidos retornam 400
- **AutenticaÃ§Ã£o**: Tokens invÃ¡lidos retornam 401
- **AutorizaÃ§Ã£o**: PermissÃµes insuficientes retornam 403
- **Recursos nÃ£o encontrados**: Retornam 404
- **Conflitos**: Duplicatas retornam 409
- **Erros do servidor**: Logs detalhados, resposta genÃ©rica em produÃ§Ã£o

## ğŸ“ˆ PrÃ³ximos Passos

### Fase 2 - Contratos
- [ ] Sistema completo de contratos de estÃ¡gio
- [ ] GeraÃ§Ã£o de PDFs com templates
- [ ] Termos aditivos
- [ ] Controle de vencimentos
- [ ] Assinaturas eletrÃ´nicas

### Fase 3 - RelatÃ³rios
- [ ] Dashboard com mÃ©tricas
- [ ] RelatÃ³rios personalizÃ¡veis
- [ ] ExportaÃ§Ã£o Excel/PDF
- [ ] GrÃ¡ficos e indicadores

### Fase 4 - NotificaÃ§Ãµes
- [ ] Sistema de emails
- [ ] NotificaÃ§Ãµes push
- [ ] Alertas automÃ¡ticos
- [ ] Templates de comunicaÃ§Ã£o

## ğŸ¤ ContribuiÃ§Ã£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo `LICENSE` para mais detalhes.

## ğŸ“ Suporte

Para dÃºvidas ou suporte, entre em contato:
- Email: suporte@cide.com.br
- GitHub Issues: [Abrir Issue](https://github.com/seu-usuario/sistema-gestao-estagios/issues)

---

**Sistema de GestÃ£o de EstÃ¡gios e Aprendizagem** - Desenvolvido com â¤ï¸ para o CIDE